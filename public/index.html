<!DOCTYPE html>
<html lang="tr">
<head>
<meta charset="UTF-8">
<title>Twitch Klip Oynatıcı</title>
<style>
  html, body {
    margin: 0;
    padding: 0;
    height: 100%;
    width: 100%;
    background: #111;
    color: #eee;
    font-family: sans-serif;
    overflow: hidden;
    display: flex;
    flex-direction: column;
  }
  #player { flex: 1; width: 100%; height: 100%; background: #000; position: relative; }
  #player iframe { position: absolute; top: 0; left: 0; width: 100%; height: 100%; border: 0; }
  #controls { display: flex; justify-content: center; gap: 12px; padding: 10px; background: rgba(0,0,0,0.5); }
  button { padding:10px 20px; font-size:16px; border:none; border-radius:5px; cursor:pointer; background:#333; color:#eee; }
  button:hover { background:#555; }
</style>
</head>
<body>
<h2 id="title" style="margin:0; padding:10px; text-align:center;">Klip Oynatıcı</h2>
<div id="player"></div>
<div id="controls">
  <button id="prev">⏮ Önceki</button>
  <button id="next">⏭ Sonraki</button>
</div>

<script>
let clips = [];
let current = 0;
let clipTimer;
const parentDomain = window.location.hostname.replace(/^www\./, "");

async function loadClips() {
  try {
    const res = await fetch("/api/clips");
    const data = await res.json();
    if(!data || !data.data || data.data.length===0){
      console.error("Klip yok veya API hatası:", data);
      return;
    }
    clips = data.data;
    document.getElementById("title").innerText = `Toplam ${data.total} Klip - En popülerden az popülere`;
    showClip(current);
  } catch(e) {
    console.error("Klip yüklenemedi:", e);
  }
}

function showClip(index){
  clearTimeout(clipTimer);
  const playerDiv = document.getElementById("player");
  playerDiv.innerHTML = "";
  const clip = clips[index];
  const iframe = document.createElement("iframe");
  iframe.src = `https://clips.twitch.tv/embed?clip=${clip.id}&parent=${parentDomain}&autoplay=true`;
  iframe.allowFullscreen = true;
  playerDiv.appendChild(iframe);

  const duration = clip.duration || 20;
  clipTimer = setTimeout(nextClip, duration*1000);
}

function prevClip(){
  current = (current - 1 + clips.length) % clips.length;
  showClip(current);
}

function nextClip(){
  current = (current + 1) % clips.length;
  showClip(current);
}

document.getElementById("prev").addEventListener("click", prevClip);
document.getElementById("next").addEventListener("click", nextClip);

window.addEventListener("keydown", (e)=>{
  if(e.key==="1") prevClip();
  if(e.key==="2") nextClip();
});

loadClips();
</script>
</body>
</html>
